name: Validate Documentation

on:
  # Run on all pull requests
  pull_request:
    branches: ["**"]

  # Run on pushes to non-master branches
  push:
    branches-ignore:
      - master

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions
permissions:
  contents: read
  pull-requests: write # Allow commenting on PRs

jobs:
  # Lint markdown files
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run markdownlint
        run: npm run lint

  # Build job (test that site builds successfully)
  build:
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true

      - name: Build with Jekyll
        run: bundle exec jekyll build --baseurl "/test"
        env:
          JEKYLL_ENV: production

      - name: Verify build output
        run: |
          if [ ! -d "_site" ]; then
            echo "Error: _site directory not created"
            exit 1
          fi
          if [ ! -f "_site/index.html" ]; then
            echo "Error: index.html not generated"
            exit 1
          fi
          echo "âœ… Jekyll build successful"
          echo "ðŸ“„ Generated $(find _site -type f | wc -l) files"

  # Summary job to provide clear status
  validate-success:
    runs-on: ubuntu-latest
    needs: [lint, build]
    if: success()
    steps:
      - name: Validation Summary
        run: |
          echo "âœ… All validation checks passed!"
          echo "- Markdown linting: PASSED"
          echo "- Jekyll build: PASSED"
          echo ""
          echo "This branch is ready to merge."
